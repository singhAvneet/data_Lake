var platforms,key,enemy,dooor,player,cursors,scoreText,startScene,button,btnL,btnR,brand,keys,btnJ,stick,pad,move,car,config={type:Phaser.AUTO,width:800,height:600,parent:"game-area",physics:{default:"arcade",arcade:{gravity:{y:300},debug:!1}},scene:{preload:preload,create:create,update:update}},game=new Phaser.Game(config),airplatform=[],stars=[],score=0,hasKey=!1,win="false",root="";function preload(){this.load.script("joystick","/assets/js/phaser-virtual-joystick.min.js"),this.load.image("brand",root+"/assets/img/brand.png"),this.load.image("button",root+"/assets/img/button.png"),this.load.image("sky",root+"/assets/img/sky.png"),this.load.image("brown2",root+"/assets/img/brown2.png"),this.load.image("ground",root+"/assets/img/platform.png"),this.load.image("ground2",root+"/assets/img/platform2.png"),this.load.image("key",root+"/assets/img/key.png"),this.load.image("gameover",root+"/assets/img/gameover.png"),this.load.image("win",root+"/assets/img/win.png"),this.load.image("keys",root+"/assets/img/keys.png"),this.load.spritesheet("btn",root+"/assets/img/button_sprite_sheet.png",{frameWidth:64,frameHeight:64}),this.load.spritesheet("btnJ",root+"/assets/img/jump.png",{frameWidth:64,frameHeight:64}),this.load.spritesheet("door",root+"/assets/img/door.png",{frameWidth:50,frameHeight:63}),this.load.spritesheet("dude",root+"/assets/img/dude.png",{frameWidth:40,frameHeight:60}),this.load.spritesheet("star",root+"/assets/img/coins.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("enemy",root+"/assets/img/enemy.png",{frameWidth:20,frameHeight:20}),this.load.spritesheet("car",root+"/assets/img/car.png",{frameWidth:152,frameHeight:50}),this.load.image("start",root+"/assets/img/start.png"),this.load.audio("coin",root+"/assets/sound/coin.wav"),this.load.audio("over",root+"/assets/sound/over.wav"),this.load.audio("won",root+"/assets/sound/won.wav"),this.load.audio("music",root+"/assets/sound/game.wav"),this.load.audio("jump",root+"/assets/sound/jump.wav"),this.load.audio("happy",root+"/assets/sound/happy.wav")}function create(){coin=this.sound.add("coin"),music=this.sound.add("music"),over=this.sound.add("over"),won=this.sound.add("won"),jump=this.sound.add("jump"),happy=this.sound.add("happy"),this.sound.context.resume(),platforms=this.physics.add.staticGroup(),this.add.image(390,250,"worker"),platforms.create(400,300,"sky"),airplatform[0]=platforms.create(440,400,"ground"),airplatform[1]=platforms.create(390,250,"ground"),airplatform[2]=platforms.create(650,190,"ground"),airplatform[3]=platforms.create(650,300,"ground"),airplatform[4]=platforms.create(16,170,"ground"),airplatform[5]=platforms.create(105,280,"ground"),platforms.create(0,504,"brown2").setOrigin(0,0).setScale(3).refreshBody(),platforms.create(0,441,"ground2").setOrigin(0,0).setScale(2).refreshBody(),scoreText=this.add.text(16,16,"SCORE: 0",{fontSize:"30px",fill:"#fff"}),btnL=this.add.sprite(100,530,"btn").setScale(2).setInteractive(),btnR=this.add.sprite(300,530,"btn").setScale(2).setInteractive(),btnJ=this.add.sprite(700,530,"btnJ").setScale(2).setInteractive(),btnL.on("pointerup",function(e){move="stop",this.anims.play("buttonUp",!0)}),btnL.on("pointerdown",function(e){move="left",this.anims.play("buttonDown",!0)}),btnR.on("pointerup",function(e){move="stop",this.anims.play("buttonUp",!0)}),btnR.on("pointerdown",function(e){move="right",this.anims.play("buttonDown",!0)}),btnJ.on("pointerdown",function(e){jump.play(),this.anims.play("buttonJDown",!0),player.setVelocityY(-330)}),btnJ.on("pointerup",function(e){this.anims.play("buttonJUp",!0)}),(player=this.physics.add.sprite(0,100,"dude")).setBounce(.2),player.setCollideWorldBounds(!0),player.body.setGravityY(150),(enemy=this.physics.add.sprite(50,400,"enemy")).setCollideWorldBounds(!0),enemy.body.setGravityY(150),(car=this.physics.add.sprite(870,400,"car")).setCollideWorldBounds(!0),car.body.setGravityY(150),car.flipX=!0,this.physics.add.collider(car,platforms),this.physics.add.overlap(car,enemy,function(){enemy.destroy()},null,this),(dooor=this.physics.add.sprite(800,410,"door")).setCollideWorldBounds(!0),dooor.body.allowGravity=!1,this.physics.add.overlap(player,dooor,function(e,t){hasKey&&(dooor.anims.play("doorOpen"),e.disableBody(!0,!0),platforms.create(400,150,"win"),airplatform.forEach(function(e){e.destroy()}),btnL.destroy(),btnR.destroy(),btnJ.destroy(),coin.destroy(),music.destroy(),over.destroy(),hasKey=!hasKey,won.play(),music.stop(),win="true",car.anims.play("carmove"))},null,this),this.anims.create({key:"buttonDown",frames:[{key:"btn",frame:0}]}),this.anims.create({key:"buttonUp",frames:[{key:"btn",frame:1}]}),this.anims.create({key:"buttonJDown",frames:[{key:"btnJ",frame:0}]}),this.anims.create({key:"buttonJUp",frames:[{key:"btnJ",frame:1}]}),this.anims.create({key:"doorClose",frames:[{key:"door",frame:0}]}),this.anims.create({key:"doorOpen",frames:this.anims.generateFrameNumbers("door",{start:0,end:4}),frameRate:20}),this.anims.create({key:"rotatecCoins",frames:this.anims.generateFrameNumbers("star",{start:0,end:3}),frameRate:20,repeat:-1}),this.anims.create({key:"right",frames:this.anims.generateFrameNumbers("dude",{start:3,end:4}),frameRate:3,repeat:-1}),this.anims.create({key:"turn",frames:[{key:"dude",frame:0}],frameRate:20}),this.anims.create({key:"left",frames:this.anims.generateFrameNumbers("dude",{start:1,end:2}),frameRate:3,repeat:-1}),this.anims.create({key:"enemyleft",frames:this.anims.generateFrameNumbers("enemy",{start:0,end:1}),frameRate:3,repeat:-1}),this.anims.create({key:"enemyright",frames:this.anims.generateFrameNumbers("enemy",{start:2,end:3}),frameRate:3,repeat:-1}),this.anims.create({key:"carmove",frames:this.anims.generateFrameNumbers("car",{start:1,end:5}),frameRate:4,repeat:-1}),this.anims.create({key:"cardisable",frames:[{key:"car",frame:5}]}),cursors=this.input.keyboard.createCursorKeys(),this.physics.add.collider(player,platforms),this.physics.add.collider(player,airplatform),this.physics.add.collider(stars,platforms),this.physics.add.collider(dooor,platforms),this.physics.add.collider(player,dooor),this.physics.add.collider(enemy,platforms);for(var e,t,s=1;s<12;s++,e=Math.floor(236*Math.random())+64,t=Math.floor(736*Math.random())+64)stars[s]=this.physics.add.sprite(t,e,"star"),stars[s].setCollideWorldBounds(!0),stars[s].setBounce(.2),stars[s].body.allowGravity=!1,this.physics.add.overlap(player,stars[s],o,null,this),this.physics.add.overlap(airplatform,stars[s],r,null,this),this.physics.add.overlap(player,enemy,a,null,this),stars[s].anims.play("rotatecCoins");function a(e,t){e.disableBody(!0,!0),platforms.create(400,150,"gameover"),over.play(),music.stop()}function r(e,t){t.x=Math.floor(736*Math.random())+64,t.y=Math.floor(236*Math.random())+64}function o(e,t){coin.play(),t.destroy(),score+=1,scoreText.setText("Score: "+score),11==score&&((key=this.physics.add.sprite(100,180,"key").setScale(2)).setCollideWorldBounds(!0),this.physics.add.collider(e,key),this.physics.add.collider(airplatform,key),this.physics.add.collider(key,platforms),this.physics.add.overlap(e,key,i,null,this))}function i(e,t){happy.play(),t.destroy(),hasKey=!hasKey}startScene=this.add.sprite(400,300,"start"),keys=this.add.sprite(400,470,"keys"),button=this.add.sprite(400,350,"button").setInteractive(),brand=this.add.sprite(400,200,"brand"),button.on("pointerdown",function(e){startScene.destroy(),music.play(),button.destroy(),brand.destroy(),keys.destroy(),music.loop=!0}),dooor.anims.play("doorClose")}function update(){"true"==win&&car.setVelocityX(-80),this.sound.context.resume(),630<=enemy.x&&(enemy.setVelocityX(-160),enemy.anims.play("enemyright")),enemy.x<=50&&(enemy.setVelocityX(160),enemy.anims.play("enemyleft")),cursors.left.isDown||"left"==move?(player.setVelocityX(-160),player.anims.play("left",!0)):cursors.right.isDown||"right"==move?(player.setVelocityX(160),player.anims.play("right",!0)):(player.setVelocityX(0),player.anims.play("turn")),cursors.up.isDown&&player.body.touching.down&&(jump.play(),player.setVelocityY(-330))}